
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mydomain.org/netexperiments/wadsecurity/labs/dc-configuration/">
      
      
        <link rel="prev" href="../single-domain-attacks/GoldenTickets/">
      
      
        <link rel="next" href="../../report/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.10">
    
    
      
        <title>Example of DC configuration - Windows Active Directory Security</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#domain-controller-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Windows Active Directory Security" class="md-header__button md-logo" aria-label="Windows Active Directory Security" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Windows Active Directory Security
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Example of DC configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../multi-domain-attacks/lab-setup/" class="md-tabs__link">
          
  
  
    
  
  Multi-domain AD Lab

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../single-domain-attacks/lab-setup/" class="md-tabs__link">
          
  
  
    
  
  Single-domain AD Lab

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../report/" class="md-tabs__link">
        
  
  
    
  
  Active Directory Extended Report

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Windows Active Directory Security" class="md-nav__button md-logo" aria-label="Windows Active Directory Security" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Windows Active Directory Security
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Multi-domain AD Lab
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Multi-domain AD Lab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/lab-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reconnaissance And Discovery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Reconnaissance And Discovery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/Network-Reconnaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/AD-Reconnaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anonymous AD reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/user-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Initial Credential Access
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Initial Credential Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/password-spraying/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password spraying
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/AS-REPRoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP Roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/LLMNR-poisoning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLMNR poisoning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lateral Movement and Relay
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Lateral Movement and Relay
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/LDAPDump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authenticated AD Reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/NTLMrelaySMB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NTLM relay to SMB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/DropTheMIC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drop the MIC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/MSSQL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/IIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IIS Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Privilege Escalation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Privilege Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/LocalPrivilegeEscalation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Privilege Escalation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/unconstrained-delegation-abuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unconstrained delegation abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/ConstrainedDelegationAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constrained delegation abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/RBCDAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBCD Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/SAMAccountNameSpoofing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SAMAccountName Spoofing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/PrintNightmare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrintNightmare
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/BloodHound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BloodHound
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/ACLAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACL Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/GPOabuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPO Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/ADCSExploiting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADCS abuse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Domain Extraction And Persistence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Domain Extraction And Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/GoldenTickets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Golden Tickets
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cross-Domain and Forest Expansion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Cross-Domain and Forest Expansion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/Trust-Reconnaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust Reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/Trustpocalypse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trustpocalypse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/ForgingTrustTickets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forging Trust Tickets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-domain-attacks/ForestTrustsAttack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest Trusts Attack
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Domain Controller configuration using GUI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Domain Controller configuration using GUI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Example of DC configuration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Example of DC configuration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-the-ip-addresses-and-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the IP addresses and domain name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rename-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      Rename the server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjust-the-clock" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust the clock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Install the Active Directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Configure DNS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-users" class="md-nav__link">
    <span class="md-ellipsis">
      Configure users
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-iis" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure IIS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure DHCP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-smb-signing" class="md-nav__link">
    <span class="md-ellipsis">
      Disable SMB signing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Single-domain AD Lab
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Single-domain AD Lab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/lab-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reconnaissance and Discovery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Reconnaissance and Discovery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/Network-Reconnaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/AD-Reconnaissance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anonymous AD reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/user-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Initial Credential Access
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Initial Credential Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/password-spraying/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password spraying
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/AS-REPRoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP Roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/LLMNR-poisoning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLMNR poisoning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Lateral Movement and Relay
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Lateral Movement and Relay
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/LDAPDump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authenticated AD Reconnaissance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/NTLMrelaySMB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NTLM relay to SMB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/DropTheMIC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drop the MIC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/MSSQL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/IIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IIS Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Privilege Escalation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Privilege Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/LocalPrivilegeEscalation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Privilege Escalation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/unconstrained-delegation-abuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unconstrained delegation abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/ConstrainedDelegationAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constrained delegation abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/RBCDAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBCD Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/SAMAccountNameSpoofing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SAMAccountName Spoofing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/PrintNightmare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrintNightmare
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/BloodHound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BloodHound
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/ACLAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACL Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/GPOabuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPO Abuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/ADCSExploiting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADCS abuse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Domain Extraction And Persistence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Domain Extraction And Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../single-domain-attacks/GoldenTickets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Golden Tickets
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Domain Controller configuration using GUI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Domain Controller configuration using GUI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Example of DC configuration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Example of DC configuration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-the-ip-addresses-and-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the IP addresses and domain name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rename-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      Rename the server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjust-the-clock" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust the clock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Install the Active Directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Configure DNS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-users" class="md-nav__link">
    <span class="md-ellipsis">
      Configure users
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-iis" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure IIS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure DHCP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-smb-signing" class="md-nav__link">
    <span class="md-ellipsis">
      Disable SMB signing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory Extended Report
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-the-ip-addresses-and-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      Configure the IP addresses and domain name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rename-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      Rename the server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjust-the-clock" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust the clock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Install the Active Directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Configure DNS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-users" class="md-nav__link">
    <span class="md-ellipsis">
      Configure users
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-iis" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure IIS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      Install and configure DHCP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-smb-signing" class="md-nav__link">
    <span class="md-ellipsis">
      Disable SMB signing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="domain-controller-configuration">Domain Controller configuration</h1>
<p>The installation and configuration of the DC involves several steps:</p>
<ol>
<li>Configure the IP addresses and domain name</li>
<li>Rename the server</li>
<li>Adjust the clock</li>
<li>Install the Active Directory</li>
<li>Configure DNS</li>
<li>Configure users</li>
<li>Install and configure IIS</li>
<li>Install and configure DHCP</li>
<li>Disable SMB signing</li>
</ol>
<h2 id="configure-the-ip-addresses-and-domain-name">Configure the IP addresses and domain name</h2>
<p>Before configuring the IP addresses, you must learn what is the subnet where the NAT cloud is operating. One way of learning is to start the attacker and check the IP address, subnet mask, and gateway it gets from the NAT DHCP server (e.g., using <code>ip add</code> and <code>ip route</code>). In our case, the subnet is <code>198.168.122.0/24</code>, and the gateway is <code>198.168.122.1</code>. Then, the following actions must be performed:</p>
<ol>
<li>Under <code>Server Manager → Local Server → Properties</code> click on the <code>Ethernet</code> link, then on the <code>Ethernet</code> adapter, and finally click <code>Properties → IPv4</code>.</li>
<li>At this window enter <code>IP address</code> as 192.168.122.10, <code>subnet mask</code> as 255.255.255.0, <code>default gateway</code> as 192.168.122.1, and <code>DNS servers</code> as 192.168.122.10 and 8.8.8.8.</li>
<li>Click <code>Advanced</code>, select the <code>DNS</code> tab, and in the box <code>DNS suffix for this connection</code> write polaris.local.</li>
<li>Apply all the changes and return to the <code>Server Manager</code> window.</li>
</ol>
<h2 id="rename-the-server">Rename the server</h2>
<ol>
<li>Change the name of the server to DC1. This can be done in the <code>Control Panel</code> under <code>System</code>. Restart the computer to apply the changes.</li>
</ol>
<h2 id="adjust-the-clock">Adjust the clock</h2>
<ol>
<li>Make sure that the time zone, the date, and the time are correctly set. The time zone must be set to UTC. The date and time must be close to the attacker’s one. The easiest way is to make the adjustments in the Control Panel.</li>
</ol>
<h2 id="install-the-active-directory">Install the Active Directory</h2>
<ol>
<li>In the <code>Server Manager</code>, click <code>Manage → Add Roles and features</code>, then click <code>Next</code> until reaching the <code>Server Roles</code> tab.</li>
<li>Check the <code>Active Directory Domain Services</code> box, click <code>Add features</code> and click <code>Next</code> until the <code>Confirmation</code> tab appears. At this tab click <code>Install</code>.</li>
<li>After the installation, click <code>Promote this server to a domain controller</code>.</li>
<li>Select <code>Add a new forest</code> and write polaris.local in the <code>Root Domain name</code> box. Then click <code>Next</code>.</li>
<li>Enter the password for the DSRM administrator account. Then click <code>Next</code> until the <code>Prerequisites</code> tab appears and click on <code>Install</code>.</li>
</ol>
<h2 id="configure-dns">Configure DNS</h2>
<ol>
<li>Go back to the IP address configuration window and reconfigure the <code>DNS servers</code> as 192.168.122.10 and 8.8.8.8. Apply the changes and return to the <code>Server Manager</code> window.</li>
<li>Click <code>Tools → DNS → DC1</code>.</li>
<li>Right-click on <code>Reverse Lookup Zones</code>, then click <code>New Zone → Next → Primary zone → Next</code> and select <code>To all DNS servers running... in this forest: polaris.local</code>.</li>
<li>Click <code>Next → IPv4 Reverse Lookup Zone → Next</code>. In <code>NetworkID</code> box enter 192.168.122. Then click <code>Next → Next → Finish</code>. A new entry should have appeared in the <code>Reverse Lookup Zones</code> tab.</li>
</ol>
<h2 id="configure-users">Configure users</h2>
<p>To configure one user, in the <code>Server Manager</code> click <code>Tools → Active Directory Users and Computers → Action → New → User</code>. Then, enter the user credentials. Uncheck the option <code>User must change password at next logon</code>. You must create four users with different characteristics, as indicated in the next table.</p>
<table>
<thead>
<tr>
<th>User logon name</th>
<th>Password</th>
<th>Domain</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>darlene.alderson</td>
<td>M00npie</td>
<td>polaris.local</td>
<td>Account with an associated SPN</td>
</tr>
<tr>
<td>leslie.romero</td>
<td>RGFyayBBcm15</td>
<td>polaris.local</td>
<td>Password in description</td>
</tr>
<tr>
<td>leon</td>
<td>Password123</td>
<td>polaris.local</td>
<td>Weak password</td>
</tr>
<tr>
<td>angela.moss</td>
<td>Jogging1988</td>
<td>polaris.local</td>
<td>Kerberos pre-authentication disabled</td>
</tr>
<tr>
<td>admin</td>
<td>Passw0rd</td>
<td>polaris.local</td>
<td>Administrator account</td>
</tr>
</tbody>
</table>
<ol>
<li>User angela.moss must be configured with the pre-authentication disabled. To do that access the user <code>Properties</code> (e.g., double-click over the username in the <code>Active Directory Users and Computers</code> window) and in the <code>Account tab → Account options</code> box check <code>Do not require Kerberos preauthentication</code>.</li>
<li>User leslie.romero must be configured with a password in the description. In the <code>General tab → Description</code> box write <code>DELETE THIS LATER! Password: RGFyayBBcm15</code>.</li>
<li>The account of darlene.alderson must have an associated SPN. To perform this configuration, click <code>Tools → ADSI Edit → Action → Connect</code>. Then in <code>DC=polaris,DC=local → CN=Users</code> search for <code>CN=darlene alderson</code>. Right-click on this CN, select <code>Properties</code> and in the <code>Attribute Editor</code> tab search for <code>servicePrincipalName</code>. Select the attribute, click <code>Edit</code> and insert <code>http/polaris.local:80</code> in the <code>Value to add</code> box.</li>
</ol>
<h2 id="install-and-configure-iis">Install and configure IIS</h2>
<ol>
<li>In the <code>Server Manager</code>, click <code>Manage → Add Roles and features</code>, then click <code>Next</code> until reaching the <code>Server Roles</code> tab.</li>
<li>Check the <code>Web Server(IIS)</code> box, click <code>Add features</code> and click <code>Next</code> until reaching the <code>Role Services</code> tab.</li>
<li>Check the <code>Windows Authentication</code> box which is one of the <code>Security</code> options. Then click <code>Next</code> until the <code>Confirmation</code> tab appears. At this tab click <code>Install</code>.</li>
<li>Click <code>Tools → Internet Information Services (IIS) Manager</code>, on the left window open <code>DC1 (Polaris\Administrator)</code> and then <code>Sites</code>, click above <code>Default Web Site</code>, on the center window double-click over Authentication. Here disable Anonymous Authentication and enable Windows Authentication.</li>
<li>On the right window open <code>Providers</code> and make sure that <code>Negotiate</code> is above <code>NTLM</code>. This ensures that Kerberos is selected first as the authentication method, and NTLM is used if Kerberos fails.</li>
<li>On the left window select <code>Application Pools</code>, on the center window click over <code>DefaultAppPool</code>, and on the right window open <code>Advanced Settings</code>. Confirm that the <code>Identity</code> attribute is set to <code>ApplicationPoolIdentity</code>.</li>
<li>On the left window select <code>Default Web Site</code>, and on the center window double-click over <code>Configuration Editor</code>. Then, in the dropdown menu select <code>system.webServer → security → authentication → windowsAuthentication</code>. Here, set <code>useAppPoolCredentials</code> to <code>False</code> and <code>useKernelMode</code> to <code>True</code>.</li>
</ol>
<h2 id="install-and-configure-dhcp">Install and configure DHCP</h2>
<ol>
<li>In the <code>Server Manager</code>, click <code>Manage → Add Roles and features</code>, then click <code>Next</code> until reaching the <code>Server Roles</code> tab.</li>
<li>Check the <code>DHCP Server</code> box, click <code>Add features</code> and click <code>Next</code> until the <code>Confirmation</code> tab appears. At this tab click <code>Install</code>. This completes the installation of the DHCP server.</li>
<li>To configure the DHCP server click <code>Tools → DHCP</code>, on the left window open <code>dc1.polaris.local</code>, right-click <code>IPv4</code>, and select <code>New Scope</code>. In the <code>Scope Name</code> window give a name to the scope, in the <code>IP Address Range</code> window configure the <code>start IP address</code>, the <code>end IP address</code>, and the subnet mask of the DHCP range (we suggest <code>192.168.122.1</code>, <code>192.168.122.254</code>, and <code>255.255.255.0</code>), in the <code>Add Exclusion and Delay</code> window exclude an IP address range to be used by attackers (we suggest <code>192.168.122.15 to 192.168.122.20</code>), in the <code>Configure DHCP Options</code> window select <code>Yes, I want to configure these options now</code>, in the <code>Router (Default Gateway)</code> window configure the IP address of the default gateway (<code>192.168.122.1</code>), in the <code>Domain Name and DNS Servers</code> window configure the parent domain as <code>polaris.local</code>, and the IP addresses of the DNS servers as <code>192.168.122.10</code> and <code>8.8.8.8</code>. Finally, in the <code>Activate Scope</code> window select <code>Yes, I want to activate this scope now</code>, click <code>Next → Finish</code>. At this point the corresponding Scope folder is added to the IPv4 section.</li>
</ol>
<h2 id="disable-smb-signing">Disable SMB signing</h2>
<p>(Only required for the SMB relay attack)</p>
<p>To disable the SMB signing you will have to change the Registry. In the <code>Server Manager</code>, click on <code>Tools → Registry Editor</code> and set to <code>0</code> the following attributes:</p>
<ul>
<li><code>RequireSecuritySignature of HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManWorkstation\Parameters</code></li>
<li><code>EnableSecuritySignature of HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManWorkstation\Parameters</code></li>
<li><code>RequireSecuritySignature of HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManServer\Parameters</code></li>
<li><code>EnableSecuritySignature of HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManServer\Parameters</code></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "content.code.copy", "navigation.indexes", "navigation.expand", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../js/pass_spray_interactive_answer.js"></script>
      
    
  </body>
</html>